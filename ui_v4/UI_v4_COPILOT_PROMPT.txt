COPILOT TASK PACK — UI v4 (Svelte) rebuild from SSOT

ROLE:
You are an exacting senior front-end engineer. Implement UI v4 as a premium "SMC Terminal".
Follow contract-first. No silent fallbacks. Performance is a first-class requirement.

INPUT SSOT DOCS (read in this order):
1) Master Guide: UI v4 _v3.md
2) Addendum v2 (SSOT): UI_v4_Addendum_v2_consolidated.md
3) Addendum v3 (SSOT): UI_v4_Addendum_v3_consolidated.md
4) Architecture Review & Slice 0 (Оновлено).md
5) Types (SSOT).md “canonical is types.ts”:
export type WsAction =
  | { action: 'switch'; symbol: string; tf: string }
  | { action: 'scrollback'; to_ms: number }
  | { action: 'drawing_add'; drawing: Drawing }
  | { action: 'drawing_update'; drawing: Drawing }
  | { action: 'drawing_remove'; id: string }
  | { action: 'overlay_toggle'; layer: string; visible: boolean }
  | { action: 'replay_seek'; to_ms: number }
  | { action: 'replay_step'; delta_bars: number }
  | { action: 'replay_play' }
  | { action: 'replay_pause' }
  | { action: 'replay_exit' };

6) WebSocket Connection (з фіксом teardown).md
7) App Frame Router (з фіксом Warnings SSOT).md
8) LWC Engine (з фіксом Dedupe Scrollback).md

PRIORITY RULE:
If conflicts exist: v3 > v2 > Master. Master examples are skeleton only.

NON-GOALS:
No TradingView clone. No Pine. No marketplace. No multi-select. No rotations.

CRITICAL RAILS (MUST):
- Canvas DPR: use ctx.setTransform(dpr,0,0,dpr,0,0) after resize. Never ctx.scale in resize lifecycle.
- RAF scheduler: latest-wins, max 1 render per frame for overlay/drawings.
- Time units: domain uses t_ms (ms). LWC uses t_sec=t_ms/1000 (seconds). Normalize coordinateToTime for number/BusinessDay.
- Converter null-safety: timeToCoordinate/coordinateToTime/priceToCoordinate/coordinateToPrice may return null. Abort interaction + emit warning; no silent fallback.
- Drawings: client-generated UUID is canonical id. Undo/Redo uses real ids. No temp_id.
- Pointer events: use Pointer Events + setPointerCapture during drag. Do not break LWC wheel/zoom/scroll in hover.

DELIVERABLES:
- WS transport + reconnect + full frame on connect
- ChartEngine with LWC candle series + scrollback (debounce + single inflight + dedupe)
- OverlayRenderer canvas layer with RAF triggers (crosshair/range/data)
- Drawings v2: tools + snap-to-OHLC + hotkeys + CommandStack
- Drawings v3: selection/hit-testing/drag-edit/eraser using screen-space geometry + AABB prefilter
- StatusBar: OHLC, latency, cursor, warnings

IMPLEMENTATION SLICES (0-5):
Follow README plan in UI_v4_COPILOT_README.md. Each slice: minimal diff, 1-3 tests, exit-gates met.

OUTPUT FORMAT:
For each slice produce:
- Files changed/added
- Explanation of rails satisfied
- Tests added and how to run them
- Manual QA checklist results

STOP RULE:
If you need to change a contract or introduce a fallback: stop, propose a contract change and explain implications instead of coding around it.
